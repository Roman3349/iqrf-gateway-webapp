!function(p,m,l){if("function"!=typeof m)return console.error("nette.ajax.js: jQuery is missing, load it please");m.nette=new(m.extend(function(){var f={self:this,initialized:!1,contexts:{},on:{init:{},load:{},prepare:{},before:{},start:{},success:{},complete:{},error:{}},fire:function(){var n=!0,r=Array.prototype.slice.call(arguments),t=r.shift(),e="string"==typeof t?t:t.name,a="object"==typeof t&&t.off||{};return r.push(f.self),m.each(f.on[e],function(t,e){if(e===l||-1!==m.inArray(t,a))return!0;var i=e.apply(f.contexts[t],r);return n=i===l||i}),n},requestHandler:function(t){var e=f.self.ajax({},this,t);if(e&&e._returnFalse)return!1},ext:function(t,e,i){for(;!i;)i="ext_"+Math.random(),f.contexts[i]&&(i=l);m.each(t,function(t,e){f.on[t][i]=e}),f.contexts[i]=m.extend(e||{},{name:function(){return i},ext:function(t,e){var i=f.contexts[t];if(!i&&e)throw"Extension '"+this.name()+"' depends on disabled extension '"+t+"'.";return i}})}};this.ext=function(i,t,e){if("object"==typeof i)f.ext(i,t);else{if(t===l)return f.contexts[i];if(t){if("string"==typeof i&&f.contexts[i]!==l)throw"Cannot override already registered nette-ajax extension '"+i+"'.";f.ext(t,e,i)}else m.each(["init","load","prepare","before","start","success","complete","error"],function(t,e){f.on[e][i]=l}),f.contexts[i]=l}return this},this.init=function(t,e){if(f.initialized)throw"Cannot initialize nette-ajax twice.";if("function"==typeof t)this.ext("init",null),this.ext("init",{load:t},e);else if("object"==typeof t)this.ext("init",null),this.ext("init",t,e);else if(t!==l)throw"Argument of init() can be function or function-hash only.";return f.initialized=!0,f.fire("init"),this.load(),this},this.load=function(){return f.fire("load",f.requestHandler),this},this.ajax=function(t,e,i){if("string"===m.type(t)&&(t={url:t}),!t.nette&&e&&i){var n,r=m(e),a=t.nette={e:i,ui:e,el:r,isForm:r.is("form"),isSubmit:r.is("input[type=submit]")||r.is("button[type=submit]"),isImage:r.is("input[type=image]"),form:null};if(a.isSubmit||a.isImage?a.form=a.el.closest("form"):a.isForm&&(a.form=a.el),t.url||(t.url=a.form?a.form.attr("action")||p.location.pathname+p.location.search:e.href),t.type||(t.type=a.form?a.form.attr("method"):"get"),r.is("[data-ajax-off]")){var o=r.attr("data-ajax-off");0===o.indexOf("[")?t.off=r.data("ajaxOff"):-1!==o.indexOf(",")?t.off=o.split(","):-1!==o.indexOf(" ")?t.off=o.split(" "):t.off=o,"string"==typeof t.off&&(t.off=[t.off]),t.off=m.grep(m.each(t.off,function(t){return m.trim(t)}),function(t){return t.length})}}return f.fire({name:"prepare",off:t.off||{}},t),t.prepare&&t.prepare(t),n=t.beforeSend,t.beforeSend=function(t,e){var i=f.fire({name:"before",off:e.off||{}},t,e);return(i||i===l)&&n&&(i=n(t,e)),i},this.handleXHR(m.ajax(t),t)},this.handleXHR=function(t,n){return n=n||{},!t||void 0!==t.statusText&&"canceled"===t.statusText||(t.done(function(t,e,i){f.fire({name:"success",off:n.off||{}},t,e,i,n)}).fail(function(t,e,i){f.fire({name:"error",off:n.off||{}},t,e,i,n)}).always(function(t,e){f.fire({name:"complete",off:n.off||{}},t,e,n)}),f.fire({name:"start",off:n.off||{}},t,n),n.start&&n.start(t,n)),t}},m.nette?m.nette:{})),m.fn.netteAjax=function(t,e){return m.nette.ajax(e||{},this[0],t)},m.fn.netteAjaxOff=function(){return this.off(".nette")},m.nette.ext("validation",{before:function(t,e){if(!e.nette)return!0;var i=e.nette,n=i.e,r=m.extend(this.defaults,e.validate||function(){if(i.el.is("[data-ajax-validate]")){var t=i.el.data("ajaxValidate");return!1===t?{keys:!1,url:!1,form:!1}:"object"==typeof t?t:void 0}}()||{}),a=!1;if(i.el.attr("data-ajax-pass")!==l&&(a="bool"!=typeof(a=i.el.data("ajaxPass"))||a),r.keys){var o=n.button||n.ctrlKey||n.shiftKey||n.altKey||n.metaKey;if(i.form){if(o&&i.isSubmit)return!(this.explicitNoAjax=!0);if(i.isForm&&this.explicitNoAjax)return this.explicitNoAjax=!1}else if(o)return!1}if(r.form&&i.form){var f;if((i.isSubmit||i.isImage)&&(i.form.get(0)["nette-submittedBy"]=i.el.get(0)),void 0===Nette.version||"2.3"==Nette.version){var s=this.ie();f=i.form.get(0).onsubmit&&!1===i.form.get(0).onsubmit(void 0!==s&&s<9?l:n)}else f=!1===(i.form.get(0).onsubmit?i.form.triggerHandler("submit"):Nette.validateForm(i.form.get(0)));if(f)return n.stopImmediatePropagation(),n.preventDefault(),!1}if(r.url){var u=i.form?e.url:i.el.attr("href");if(/(?:^[a-z][a-z0-9+.-]*:|\/\/)/.test(u)){var c=new URL(u);if(/:|^#/.test(c.pathname+c.search+c.hash))return!1}else if(/:|^#/.test(u))return!1}return a||(n.stopPropagation(),n.preventDefault(),t._returnFalse=!0),!0}},{defaults:{keys:!0,url:!0,form:!0},explicitNoAjax:!1,ie:function(t){for(var e=3,i=document.createElement("div"),n=i.getElementsByTagName("i");i.innerHTML="\x3c!--[if gt IE "+ ++e+"]><i></i><![endif]--\x3e",n[0];);return 4<e?e:t}}),m.nette.ext("forms",{init:function(){var t;p.Nette&&(t=this.ext("snippets"))&&t.after(function(t){t.find("form").each(function(){p.Nette.initForm(this)})})},prepare:function(t){var e=t.nette;if(e&&e.form){var i=e.e,n=t.data||{},r={};if(e.isSubmit)r[e.el.attr("name")]=e.el.val()||"";else if(e.isImage){var a=e.el.offset(),o=e.el.attr("name"),f=[Math.max(0,i.pageX-a.left),Math.max(0,i.pageY-a.top)];-1!==o.indexOf("[",0)?r[o]=f:(r[o+".x"]=f[0],r[o+".y"]=f[1])}var s=e.form.attr("method");if(s&&"post"===s.toLowerCase()&&"FormData"in p){var u=new FormData(e.form[0]);for(var c in r)u.append(c,r[c]);if("string"!=typeof n)for(var c in n)u.append(c,n[c]);if(u.entries&&navigator.userAgent.match(/version\/11(\.[0-9]*)? safari/i))for(var l in u.entries())l[1]instanceof File&&""===l[1].name&&0===l[1].size&&u.delete(l[0]);t.data=u,t.processData=!1,t.contentType=!1}else"string"!=typeof n&&(n=m.param(n)),r=m.param(r),t.data=e.form.serialize()+(r?"&"+r:"")+"&"+n}}}),m.nette.ext("snippets",{success:function(t){t.snippets&&this.updateSnippets(t.snippets)}},{beforeQueue:m.Callbacks(),afterQueue:m.Callbacks(),completeQueue:m.Callbacks(),before:function(t){this.beforeQueue.add(t)},after:function(t){this.afterQueue.add(t)},complete:function(t){this.completeQueue.add(t)},updateSnippets:function(t,e){var i=this,n=[];for(var r in t){var a=this.getElement(r);a.get(0)&&n.push(a.get(0)),this.updateSnippet(a,t[r],e)}m(n).promise().done(function(){i.completeQueue.fire()})},updateSnippet:function(t,e,i){t.is("title")?document.title=e:(this.beforeQueue.fire(t),this.applySnippet(t,e,i),this.afterQueue.fire(t))},getElement:function(t){return m("#"+this.escapeSelector(t))},applySnippet:function(t,e,i){!i&&t.is("[data-ajax-append]")?t.append(e):!i&&t.is("[data-ajax-prepend]")?t.prepend(e):(t.html()!=e||/<[^>]*script/.test(e))&&t.html(e)},escapeSelector:function(t){return t.replace(/[\!"#\$%&'\(\)\*\+,\.\/:;<=>\?@\[\\\]\^`\{\|\}~]/g,"\\$&")}}),m.nette.ext("redirect",{success:function(t){if(t.redirect)return p.location.href=t.redirect,!1}}),m.nette.ext("state",{success:function(t){t.state&&(this.state=t.state)}},{state:null}),m.nette.ext("unique",{start:function(t){this.xhr&&this.xhr.abort(),this.xhr=t},complete:function(){this.xhr=null}},{xhr:null}),m.nette.ext("abort",{init:function(){m("body").keydown(m.proxy(function(t){this.xhr&&"27"===t.keyCode.toString()&&!(t.ctrlKey||t.shiftKey||t.altKey||t.metaKey)&&this.xhr.abort()},this))},start:function(t){this.xhr=t},complete:function(){this.xhr=null}},{xhr:null}),m.nette.ext("load",{success:function(){m.nette.load()}}),m.nette.ext("init",{load:function(t){m(this.linkSelector).off("click.nette",t).on("click.nette",t),m(this.formSelector).off("submit.nette",t).on("submit.nette",t).off("click.nette",":image",t).on("click.nette",":image",t).off("click.nette",":submit",t).on("click.nette",":submit",t),m(this.buttonSelector).closest("form").off("click.nette",this.buttonSelector,t).on("click.nette",this.buttonSelector,t)}},{linkSelector:"a.ajax",formSelector:"form.ajax",buttonSelector:'input.ajax[type="submit"], button.ajax[type="submit"], input.ajax[type="image"]'})}(window,window.jQuery);
